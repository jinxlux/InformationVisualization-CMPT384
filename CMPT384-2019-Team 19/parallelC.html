<!-- xudong Li, xul395, 11206927 -->
<!-- luohan du, lud380,11201129 -->
<!DOCTYPE html>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="d3.parcoords.js"></script>
<link rel="stylesheet" type="text/css" href="d3.parcoords.css">

<head>
  <title>Summer Olympic medallists 1896 to 2008</title>
  <style>
    h1 {
      position: absolute;
      left: 200px
    }
  </style>
</head>

<body>
  <h1>Summer Olympic medallists 1896 to 2008 visualized in parallel coordinate</h1>
<div id="parallelC" class="parcoords" style="width:1260px;height:720px;"></div>
<script>

//parallel coordinates object initialize
var parcoords = d3.parcoords()("#parallelC");
//dic for saving colors for each nation
var nations = {};
//array for saving colors for each gender
var GenderColor = ["rgba(0,0,100,0.1)","rgba(150,0,0,0.1)"];
//array for saving number of medels for each gender
var gender_compare = [0,0];
//array for saving number of medels for each nation
var nation_compare = {};

// read csv file, create parallel coordinate 
d3.csv('t.csv', function(d,i) {
  var Nat = "other";
  if(d.NOC == "USA" || d.NOC == "CAN" || d.NOC == "JPN" || d.NOC == "CHN" || d.NOC == "KOR" || d.NOC == "IND"){
    Nat = d.NOC;
  }
  else if(d.NOC == "FRA" || d.NOC == "GBR" || d.NOC == "GER" || d.NOC == "BRA" || d.NOC == "MEX"){
    Nat = d.NOC;
  }
  else if(d.NOC == "RUS" || d.NOC == "URS"){
    Nat = d.NOC;
  }

  return {
    City : d.City,
    Year : d.Edition,
    Gender : d.Gender,
    Medal : d.Medal,
    Nation: Nat,
    Sport: d.Sport,
    ID: i
  };
},function(data){
  fill(nations,gender_compare,nation_compare,data);
  console.log(nation_compare);
  parcoords.data(data)
  .margin({ top: 100, left: 150, bottom: 200, right: 0})
  .alpha(0.25)
  .mode("queue")
  .color(function(data){
    if(data.Gender=="Men"){
      return "rgba(0,0,100,0.1)";
    }else{
      return "rgba(150,0,0,0.1)";
    }
  })
  .render()
  .brushMode("1D-axes")
  .reorderable()
  .interactive();


  parcoords.svg.selectAll("text")
    .style("font", "12px sans-serif")
    .style("fill","green");
  
  
  parcoords.svg.selectAll(".dimension")
    .on("click", change_color)
    .selectAll(".label")
    .style("font-size", "14px");
  
  
});

//fill out global variables
function fill(nations,gender_compare,nation_compare,data){
  var colorL = ["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928","#b15928","#b15928"];
  var i = 0;
  data.forEach(function(item, index){
    if(!(item.Nation in nations)){
      nation_compare[item.Nation] = 1;
      nations[item.Nation] = colorL[i];
      i++;
    }else{
      nation_compare[item.Nation]++;
    }
    if (item.Gender == "Men"){
      gender_compare[0] ++;
    }else{
      gender_compare[1] ++;
    }
  });
}

// change the color to focus on one dimension
function change_color(dimension) {
  if(dimension!="Gender" && dimension!="Medal" && dimension!="Nation"){
    d3.selectAll('circle').remove();
    d3.select('#wrapper').selectAll('text').remove();
    return;
  }
  if(dimension=="Gender"){
    d3.selectAll('circle').remove();
    d3.select('#wrapper').selectAll('text').remove();
    createBall(); 
  }
  else if(dimension=="Nation")  {
    d3.selectAll('circle').remove();
    d3.select('#wrapper').selectAll('text').remove();
    createBallForNa();   
  }else{
    d3.selectAll('circle').remove();
    d3.select('#wrapper').selectAll('text').remove();
  }
  parcoords.svg.selectAll(".dimension")
    .selectAll(".label")
    .style("font-size", "14px")
    .filter(function(d){ 
      return d == dimension; })
    .style("font-size", "22px");
  change(dimension);
}

// help function for change_color
function change(dimension){

  var tempdata = parcoords.data;
  if(dimension == "Medal"){
    parcoords.color(function(tempdata){
      if(tempdata.Medal == "Gold"){
        return "rgba(0,100,0,0.1)"; 
      }else if(tempdata.Medal == "Silver"){
        return "rgba(100,0,0,0.1)"; 
      }else{
        return "rgba(0,0,100,0.1)"
      }
    }).render();
  }else if(dimension == "Gender"){
    parcoords
      .color(function(tempdata){
        if(tempdata.Gender=="Men"){
          return GenderColor[0];
        }else{
          return GenderColor[1];
        }
      }).render();
  }else if(dimension == "Nation"){
    parcoords.color(function(tempdata){
      return nations[tempdata.Nation];
    }).render();
  }
}

// create balls for genders
function createBall(){
  var myData = gender_compare;
  var xP = [];
  var svg = d3.select('svg');
  svg.append('g')
     .attr('id',"wrapper")
     .attr('transform',"translate(40, 40)");
  d3.select('#wrapper').selectAll('circle')
    .data(myData)
    .enter()
    .append('circle')
    .attr("cx",function(d,i){
      if(i==0){
        xP.push(410);
        return 410;
      }else{
        xP.push((myData[i-1]/300)+20+xP[i-1]+d/300);
        return (myData[i-1]/300)+20+xP[i-1]+d/300;
      }
    })
    .attr("cy",600)
    .attr("r",function(d){
      return d/300;
    })
    .style("fill",function(d,i){
      return GenderColor[i];
    });
    d3.select('#wrapper').selectAll('text')
      .data(myData)
      .enter()
      .append('text')
      .attr("dx",function(d,i){
      if(i==0){
        xP.push(410);
        return 410;
      }else{
        xP.push((myData[i-1]/300)+xP[i-1]+d/300-10);
        return (myData[i-1]/300)+xP[i-1]+d/300-10;
      }
    })
    .attr("dy",520)
    .text(function(d,i){
      if(i==0)
        return "Men:".concat(d.toString());
      else
        return "Women:".concat(d.toString());
    })
    .style("font-size", "12px");
}

// create balls for nations
function createBallForNa(){
  // var sortable = [];
  // for (var nation in nation_compare) {
  //   sortable.push([nation, nation_compare[nation]]);
  // }
  // sortable.sort(function(a, b) {
  //   return b[1] - a[1];
  // });
  // var objSorted = {}
  // sortable.forEach(function(item){
  //   objSorted[item[0]]=item[1]
  // })

  var myData = Object.values(nation_compare);
  var nationName = Object.keys(nation_compare);
  var xP = [];
  var svg = d3.select('svg');
  svg.append('g')
     .attr('id',"wrapper")
     .attr('transform',"translate(40, 40)");
  d3.select('#wrapper').selectAll('circle')
    .data(myData)
    .enter()
    .append('circle')
    .attr("cx",function(d,i){
      if(i==0){
        xP.push(200);
        return 200;
      }else{
        xP.push((myData[i-1]/200)+20+xP[i-1]+d/200);
        return (myData[i-1]/200)+20+xP[i-1]+d/200;
      }
    })
    .attr("cy",600)
    .attr("r",function(d){
      return d/200;
    })
    .style("fill",function(d,i){
      return nations[nationName[i]];
    });
    d3.select('#wrapper').selectAll('text')
      .data(myData)
      .enter()
      .append('text')
      .attr("dx",function(d,i){
      if(i==0){
        xP.push(190);
        return 190;
      }else{
        xP.push((myData[i-1]/200)+10+xP[i-1]+d/200);
        return (myData[i-1]/200)+10+xP[i-1]+d/200;
      }
    })
    .attr("dy",550)
    .text(function(d,i){
      return nationName[i].concat(":",d.toString());
    })
    .style("font-size", function(d,i){
      if(nationName[i]=="other"){
        return "15px";
      }
      else{
        return "5px";
      }
      return (d/200).toString().concat("px");
    })

}

</script>
</body>
</html>